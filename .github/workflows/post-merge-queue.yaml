name: Post merge queue CI

# Trigger the workflow on push or pull request events
on:
  push:
    branches:
        - main

# Define the jobs
jobs:
  decode-base64:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Extract the commit message
      - name: Get commit message
        id: get_commit_message
        run: |
          commit_message="${{ github.event.commits[0].message }}"
          echo "Commit message: $commit_message"
          echo "BASE64_STRING=$commit_message" >> $GITHUB_ENV

      # Step 2: Decode the Base64 string and save as JSON
      - name: Decode Base64 string
        run: |
          decoded_json=$(echo "$BASE64_STRING" | base64 --decode)
          echo "Decoded JSON: $decoded_json"
          echo "$decoded_json" > decoded.json

      # Step 3: Parse JSON and set as environment variables
      - name: Set environment variables from JSON
        run: |
          for key in $(jq -r 'keys[]' decoded.json); do
            value=$(jq -r ".\"$key\"" decoded.json)
            echo "$key=$value" >> $GITHUB_ENV
          done

      # Step 4: Use environment variables in subsequent steps
      - name: Print environment variables
        run: |
          echo "Decoded key1: ${{env.key1}}"
          echo "Decoded key2: ${{env.key2}}"

  test:
    # Define the operating system to run the job
    runs-on: ubuntu-latest

    steps:
      - name: Print GitHub Context
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
        run: echo "$GITHUB_CONTEXT"

      - name: Print commit message Base64
        run: echo ${{github.event.head_commit.message}}
            
    
    